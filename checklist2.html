<!DOCTYPE html><html lang="ko"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ì ê²€ì¼ì§€(A) â€” iOS í˜¸í™˜ ì•ˆì •íŒ</title>
<style>
:root{
  --safe:182mm; --gap:6mm; --bg:#0b1220; --panel:#0f172a; --brand:#2f6feb; --thead:#f3f3f3;
  --cap-lines:2; --cap-lh:1.25; --cap-h:calc(var(--cap-lines)*var(--cap-lh)*1em);
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:#e9eef6;font-family:"ë§‘ì€ ê³ ë”•",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.wrap{max-width:980px;margin:0 auto}

/* ìƒë‹¨ ê³ ì • */
.sticky{position:sticky;top:0;z-index:20;background:#0b1220e6;backdrop-filter:blur(6px);border-bottom:1px solid #ffffff22}
.tabs{display:flex;gap:8px;padding:12px}
.tab{flex:1;padding:10px;border-radius:12px;background:#1b2640;border:1px solid #ffffff24;color:#cde1ff;cursor:pointer}
.tab.active{background:var(--brand);color:#fff}
.head{display:grid;grid-template-columns:1fr auto auto auto;gap:8px;padding:0 12px 12px}
.disp{grid-column:1/-1;padding:12px;background:#101a2c;border:1px solid #ffffff1a;border-radius:12px;text-align:center;font-size:18px}
.btn{padding:10px 12px;border-radius:12px;border:1px solid #ffffff24;background:#16213a;color:#e9eef6}.btn.primary{background:var(--brand)}

/* ë³¸ë¬¸ ë¦¬ìŠ¤íŠ¸ */
.list{padding:12px;display:flex;flex-direction:column;gap:12px}
.row{background:var(--panel);border:1px solid #ffffff18;border-radius:14px;padding:12px;display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between}
.rowHead{width:100%;display:flex;align-items:center;gap:12px}
.ctrls{display:flex;gap:12px;align-items:center}
.toggle{width:56px;height:30px;border-radius:999px;background:#475569;position:relative;border:1px solid #0006;cursor:pointer}
.toggle .k{position:absolute;top:2px;left:2px;width:26px;height:26px;border-radius:50%;background:#cbd5e1;transition:transform .18s}
.toggle.on{background:#14532d}.toggle.on .k{transform:translateX(26px);background:#34d399}
.num{display:flex;align-items:center;border:1px solid #ffffff24;border-radius:10px;overflow:hidden}
.num button{width:32px;height:32px;border:0;background:#16213a;color:#cfe3ff}
.num input{width:64px;height:32px;background:#0b1220;border:0;color:#e9eef6;text-align:center}
.meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.meta input[type=file]{display:none}
.meta label{border:1px dashed #3b82f6;padding:6px 10px;border-radius:10px;color:#cde1ff;cursor:pointer}
.note{flex:1;min-width:220px;border:1px solid #ffffff24;background:#0b1220;color:#e9eef6;border-radius:10px;padding:8px}
.tiny{font-size:12px;color:#93a6bf}

/* ì¸ì‡„ */
@page{size:A4;margin:12mm}
.print{display:none;color:#000;background:#fff}
.print .page{width:var(--safe);margin:0 auto}
.tbl{width:100%;border-collapse:collapse;font-size:11px;table-layout:fixed}
.tbl th,.tbl td{border:1px solid #000;padding:6px;vertical-align:top;word-break:break-word}
.tbl th{background:var(--thead)}
.photo-title{margin:10px 0 6px;font-weight:700;color:#000}
.row-block{break-inside:avoid;page-break-inside:avoid;margin-bottom:var(--gap)}
.photo-grid3{width:100%;display:grid;gap:var(--gap);grid-template-columns:repeat(3,1fr)}
.cell{display:flex;flex-direction:column;align-items:center}
.phase-tag{width:100%;text-align:center;font-size:12px;font-weight:700;border-bottom:1px solid #000;padding:4px 0;background:#f8f8f8;color:#000}

/* âœ… ì¸ì‡„ ì „ìš© ì‚¬ì§„ë°•ìŠ¤ â€” iOS ì•ˆì „ í´ë°±(::before) + EXIF ìë™ ë°©í–¥ */
.print .imgbox{position:relative;border:1px solid #000;background:#fff;overflow:hidden}
.print .imgbox::before{content:"";display:block;padding-top:75%} /* 4:3 í´ë°± */
.print .imgbox > img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;image-orientation:from-image}
@supports (aspect-ratio: 4 / 3) {
  .print .imgbox{aspect-ratio:4/3}
  .print .imgbox::before{content:none}
  .print .imgbox > img{position:static}
}

.cap{margin-top:4px;height:var(--cap-h);line-height:var(--cap-lh);display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;gap:2px}
.cap .name{max-width:96%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cap .time{font-size:11px;opacity:.8}
.empty{opacity:.55;font-size:12px;color:#000;position:absolute;inset:0;display:flex;align-items:center;justify-content:center}

@media print{
  body{background:#fff;color:#000;-webkit-print-color-adjust:exact;print-color-adjust:exact}
  .sticky,.list{display:none!important}
  .print{display:block!important}
}
</style>
</head><body>
<div class="wrap">
  <div class="sticky">
    <div class="tabs" id="phaseTabs">
      <button class="tab active" data-phase="ì‘ì—…ì „">ì‘ì—…ì „</button>
      <button class="tab" data-phase="ì‘ì—…ì¤‘">ì‘ì—…ì¤‘</button>
      <button class="tab" data-phase="ì‘ì—…í›„">ì‘ì—…í›„</button>
    </div>
    <div class="head">
      <!-- ì‹œê°„ë§Œ ë…¸ì¶œ -->
      <div class="disp"><b id="now"></b></div>
      <button class="btn" id="saveBtn">ì„ì‹œì €ì¥</button>
      <button class="btn primary" id="printBtn">ğŸ–¨ï¸ ì¸ì‡„</button>
      <button class="btn" id="resetBtn">ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="list" id="list"></div>

  <!-- ì¸ì‡„ ì „ìš© -->
  <section class="print">
    <div class="page">
      <div style="text-align:center;border:1px solid #000;display:flex;align-items:stretch;flex-direction:row;justify-content:space-between">
        <div style="border:1px solid #000;font-size:12px;width:60%">
          <h1 style="font-size:2em;margin:0;padding-top:15px">ì‘ì—…ì¥/ì‹œì„¤ìœ„ìƒ ì ê²€ë¦¬ìŠ¤íŠ¸</h1>
          <p style="line-height:180%;padding-left:25px;font-size:14px;text-align:left">
            ì ê²€ì¼: <span id="pDate"></span> ( ì£¼ê¸° : ë§¤ì¼ )<br>ì ê²€ì: <span id="pPlace">í™ì„±ë•</span>
          </p>
        </div>
        <div style="display:flex;flex-direction:row;width:40%;flex-wrap:nowrap">
          <div style="border:1px solid #000;text-align:center;width:16%;display:flex;justify-content:center;align-items:center">ê²°<br/>ì¬</div>
          <div style="font-weight:bold;width:28%;border:1px solid #000;font-size:14px;display:flex;flex-direction:column"><div style="text-align:center;border-bottom:1px solid #000;padding:4px;width:100%">ì‘ì„±</div><div style="height:35px"></div></div>
          <div style="font-weight:bold;width:28%;border:1px solid #000;font-size:14px;display:flex;flex-direction:column"><div style="text-align:center;border-bottom:1px solid #000;padding:4px;width:100%">ê²€í† </div><div style="height:35px"></div></div>
          <div style="font-weight:bold;width:28%;border:1px solid #000;font-size:14px;display:flex;flex-direction:column"><div style="text-align:center;border-bottom:1px solid #000;padding:4px;width:100%">ìŠ¹ì¸</div><div style="height:35px"></div></div>
        </div>
      </div>
      <br/>
      <table class="tbl">
        <thead>
          <tr>
            <th style="width:22mm">êµ¬ë¶„</th><th style="width:80mm">ì ê²€ì‚¬í•­</th>
            <th style="width:13mm">ì‘ì—…ì „</th><th style="width:13mm">ì‘ì—…ì¤‘</th><th style="width:13mm">ì‘ì—…í›„</th>
            <th style="width:30mm">ì ê²€ì ì˜ê²¬</th>
          </tr>
        </thead>
        <tbody id="pBody"></tbody>
      </table>
      <br/>
      <div id="pPhotos"></div>
    </div>
  </section>
</div>

<script>
/* ========= ì €ì¥(ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í´ë°±) ========= */
const STORE_KEY="chk-A-tabbed";
let S={}, S_RAM="{}";
try{ S = JSON.parse(localStorage.getItem(STORE_KEY)||"{}"); }catch(e){ try{ S=JSON.parse(S_RAM)||{} }catch(_){ S={} } }
function save(){ try{ localStorage.setItem(STORE_KEY, JSON.stringify(S)); } catch(e){ S_RAM = JSON.stringify(S); } }

/* ========= ê¸°ë³¸ ë°ì´í„° ========= */
const ITEMS=[
 {g:"ì¶œì…êµ¬(ì†Œë…ì‹¤)",t:"ì¥í™” ì„¸ì²™ê¸°ëŠ” ì‘ë™ì´ ì˜ë˜ê³  ìˆëŠ”ê°€?",type:"toggle"},
 {g:"ì¶œì…êµ¬(ì†Œë…ì‹¤)",t:"ì† ì„¸ì²™ ì†Œë…ì‹œì„¤ ì´ìƒ ìœ ë¬´ ë° ì•Œì½”ì˜¬ ì”ëŸ‰ìƒíƒœ",type:"toggle"},
 {g:"ì¶œì…êµ¬(ì†Œë…ì‹¤)",t:"ì¥í™” ì†Œë…ì¡°ì— ì†Œë…ì•½ì€ ê¸°ì¤€ëŸ‰ì´ìƒ íˆ¬ì…í–ˆëŠ”ê°€?",type:"toggle"},
 {g:"ì†Œë…ì¡°",t:"ì† ì†Œë…ìˆ˜ëŠ” ê¹¨ë—í•˜ë©° ì£¼ê¸°ì ìœ¼ë¡œ êµì²´í•˜ê³  ìˆë‚˜??",type:"toggle"},
 {g:"ì†Œë…ì¡°",t:"ì¹¼ ì†Œë…ì¡° ì˜¨ë„ëŠ” 83â„ƒ ì´ìƒìœ¼ë¡œ ì ì ˆí•œê°€?",type:"number",unit:"â„ƒ",min:0,max:100,step:0.5,std:83},
 {g:"í†µë¡œ",t:"ì‘ì—…ì¥ í†µë¡œì— ì˜¤ì—¼ ë¬¼ì§ˆì€ ì—†ëŠ”ê°€?",type:"toggle"},
 {g:"í†µë¡œ",t:"ê³ ì••ì„¸ì²™ê¸° ê°€ë™ ìƒíƒœëŠ” ì–‘í˜¸í•œê°€?",type:"toggle"},
 {g:"ì²­ì†Œë„êµ¬",t:"ì²­ì†Œë„êµ¬ ë³´ê´€ ë° ìƒíƒœëŠ” ì–‘í˜¸í•œê°€?",type:"toggle"},
 {g:"ì²­ì†Œë„êµ¬",t:"ì²­ì†Œìš© ì„¸ì²™ì œëŠ” ì ëŸ‰ ë° ì•ˆì „ ì¬ê³ ë¡œ ê´€ë¦¬ë˜ëŠ”ê°€?",type:"toggle"},
 {g:"ì¡°ëª…/í™˜ê¸°",t:"ì‘ì—…ì¥ë‚´ ì¡°ëª…ì˜ ì¡°ë„ëŠ” ì ë‹¹í•œê°€?",type:"toggle"},
 {g:"ì¡°ëª…/í™˜ê¸°",t:"ì‘ì—…ì¥ë‚´ ì¡°ëª…ì˜ ë“±ë³´í˜¸ì¥ì¹˜ëŠ” ì–‘í˜¸í•œê°€?",type:"toggle"},
 {g:"ì¡°ëª…/í™˜ê¸°",t:"ì‘ì—…ì¥ë‚´ í™˜ê¸°ëŠ” ì˜ ë˜ê³ ìˆëŠ”ê°€?",type:"toggle"},
 {g:"ì²œì •ã†ë²½",t:"ì‘ì—…ì¥ë‚´ ì‘ê²°ìˆ˜ëŠ” ì—†ëŠ”ê°€?",type:"toggle"},
 {g:"ì²œì •Â·ë²½",t:"ì‘ì—…ì¥ë‚´ ë²½ê³¼ ì²œì¥ì— íŒŒì†/ëˆ„ìˆ˜í˜„ìƒ, ì˜¤ì—¼ë¬¼ì§ˆì€ ì—†ëŠ”ê°€?",type:"toggle"},
 {g:"ë°”ë‹¥",t:"ì‘ì—…ì¥ ë°”ë‹¥ì— ë¬¼ê¸°ê°€ ê³ ì¸ ê³³ì€ ì—†ëŠ”ê°€?",type:"toggle"},
 {g:"ë°”ë‹¥",t:"ì‘ì—…ì¥ ë°”ë‹¥ì— ì˜¤ì—¼ë¬¼ì§ˆ(ì§€ë°© ë“±)ì€ ì—†ëŠ”ê°€?",type:"toggle"},
 {g:"ê¸‰ìˆ˜/ë°°ìˆ˜",t:"ì²­ì†Œ ë° ì‘ì—…ì— í•„ìš”í•œ ê¸‰ìˆ˜ëŠ” ì–‘í˜¸í•œê°€?",type:"toggle"},
 {g:"ë°©ì¶©/ë°©ì„œ",t:"ì°½ë¬¸ì— ì„¤ì¹˜ëœ ë°©ì¶©ë§ì˜ ìƒíƒœëŠ” ì–‘í˜¸í•œê°€?",type:"toggle"},
 {g:"ë°©ì¶©/ë°©ì„œ",t:"ì‘ì—…ì¥ì— ì¥ ëª¨ê¸° íŒŒë¦¬ ë“± í•´ì¶©ì€ ì—†ëŠ”ê°€?",type:"toggle"},
 {g:"íê¸°ë¬¼ë³´ê´€ì†Œ",t:"íê¸°ë¬¼ ê´€ë¦¬ëŠ” ì˜ë˜ê³  ìˆëŠ”ê°€?",type:"toggle"},
 {g:"íê¸°ë¬¼ë³´ê´€ì†Œ",t:"ì²­ì†Œ ë° ì •ë¦¬ì •ëˆì€ ì˜ë˜ê³  ìˆëŠ”ê°€?",type:"toggle"},
 {g:"ì†Œë…ì œ",t:"ì‘ì—…ì¥ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì†Œë… ë¶„ë¬´ê¸°ì˜ ì†Œë…ì œ ì”ëŸ‰ìƒíƒœ",type:"toggle"},
 {g:"ì†Œë…ì œ",t:"ì ì • ì†Œë…ì•½í’ˆì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°, í‘œì‹œ/êµ¬ë¶„(ë¼ë²¨ë§)í•˜ì—¬ ì†Œë…ì¤€ë¹„ì‹¤ì— ë³´ê´€ ìœ ë¬´",type:"toggle"},
 {g:"í™”ì¥ì‹¤",t:"í™”ì¥ì‹¤ ì²­ì†Œ ìƒíƒœëŠ” ì–‘í˜¸í•˜ê³  ë°°ìˆ˜ê´€ ë° ë³€ê¸° ë§‰í˜ì€ ì—†ëŠ”ê°€?",type:"toggle"},
 {g:"í™”ì¥ì‹¤",t:"ì†ì„¸ì²™ ì„¸ì œ(ë¬¼ë¹„ëˆ„ ë“±) ë¹„ì¹˜ ë° ì†Œë…ì œ ì”ëŸ‰ìƒíƒœ",type:"toggle"},
 {g:"íœ´ê²Œì‹¤(íƒˆì˜ì‹¤)/ëª©ìš•ì‹¤",t:"íœ´ê²Œì‹¤ ì •ë¦¬ì •ëˆì€ ì˜ë˜ì–´ ìˆëŠ”ê°€?",type:"toggle"},
 {g:"íœ´ê²Œì‹¤(íƒˆì˜ì‹¤)/ëª©ìš•ì‹¤",t:"ëª©ìš•ì‹¤ì˜ ë°°ìˆ˜ëŠ” ì •ìƒì ì¸ê°€?",type:"toggle"}
];
const PHASES=["ì‘ì—…ì „","ì‘ì—…ì¤‘","ì‘ì—…í›„"];
const cur=()=>document.querySelector(".tab.active").dataset.phase;
const keyV=(p,i)=>`${p}__${i}`, keyN=(p,i)=>`${p}__${i}__note`, keyP=(p,i)=>`${p}__${i}__photo`, keyD=(p,i)=>`${p}__${i}__data`, keyT=(p,i)=>`${p}__${i}__time`;

/* ========= UI ë¹Œë“œ ========= */
function build(){
  const root=document.getElementById('list'); root.innerHTML='';
  ITEMS.forEach((it,i)=>{
    const row=document.createElement('div'); row.className='row';
    row.innerHTML=`<div class="rowHead"><b>[${it.g}]</b>&nbsp;${it.t}</div>`;

    const ctr=document.createElement('div'); ctr.className='ctrls';
    if(it.type==='toggle'){
      const t=document.createElement('div'); t.className='toggle'; t.innerHTML='<div class="k"></div>';
      if(S[keyV(cur(),i)]===true) t.classList.add('on');
      t.onclick=()=>{ const v=!t.classList.contains('on'); t.classList.toggle('on',v); S[keyV(cur(),i)]=v; save(); };
      ctr.appendChild(t);
    }else{
      const wrap=document.createElement('div'); wrap.className='num';
      wrap.innerHTML=`<button>-</button><input type="number" min="${it.min}" max="${it.max}" step="${it.step||1}" value="${S[keyV(cur(),i)]??it.std??0}"><button>+</button>`;
      const [minus,input,plus]=wrap.children;
      const sync=v=>{ v=Math.max(it.min,Math.min(it.max,Number(v))); input.value=v; S[keyV(cur(),i)]=v; save(); };
      minus.onclick=()=>sync(Number(input.value)-(it.step||1));
      plus.onclick=()=>sync(Number(input.value)+(it.step||1));
      input.onchange=()=>sync(input.value);
      ctr.appendChild(wrap);
    }
    row.appendChild(ctr);

    const meta=document.createElement('div'); meta.className='meta';
    const f=document.createElement('input'); f.type='file'; f.accept='image/*'; f.setAttribute('capture','environment'); f.id=`f_${i}`;
    const lab=document.createElement('label'); lab.setAttribute('for',f.id); lab.textContent='ğŸ“· ì¦ë¹™';
    const tiny=document.createElement('span'); tiny.className='tiny'; tiny.textContent=S[keyP(cur(),i)]?`ì²¨ë¶€: ${S[keyP(cur(),i)]}`:'ì‚¬ì§„ ì—†ìŒ';
    f.onchange=async()=>{ const file=f.files?.[0]; if(!file) return;
      const name=`${cur()}-${it.g}.jpg`;
      try{
        const {dataURL}=await compressImage(file,1024,0.8); // iOS ë©”ëª¨ë¦¬ ì•ˆì •ê°’
        S[keyD(cur(),i)]=dataURL; S[keyP(cur(),i)]=name; S[keyT(cur(),i)]=Date.now(); save();
        tiny.textContent=`ì²¨ë¶€: ${name}`;
      }catch{
        const r=new FileReader(); r.onload=()=>{ S[keyD(cur(),i)]=r.result; S[keyP(cur(),i)]=name; S[keyT(cur(),i)]=Date.now(); save(); tiny.textContent=`ì²¨ë¶€: ${name}`; }; r.readAsDataURL(file);
      }
    };
    const note=document.createElement('textarea'); note.className='note'; note.placeholder='ë¹„ê³ (ë©”ëª¨)'; note.value=S[keyN(cur(),i)]||"";
    note.onchange=()=>{ S[keyN(cur(),i)]=note.value; save(); };
    meta.append(lab,f,tiny,note);
    row.appendChild(meta);

    root.appendChild(row);
  });
}

/* ========= ì¸ì‡„ ========= */
function escapeHTML(s){return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
function collectNotes(i){
  const parts=[];
  for(const p of PHASES){
    const n=S[keyN(p,i)];
    if(n && n.trim()){
      parts.push(`<b>[${p}]</b> `+escapeHTML(n).replace(/\r?\n/g,'<br>'));
    }
  }
  return parts.length? parts.join('<br>') : '-';
}
function fmt(t){ const d=new Date(t||Date.now()); const p=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}`; }

function buildPrint(){
  // ë‚ ì§œ ìŠ¤ëƒ…ìƒ·
  const d=document.getElementById('pDate'); if(d) d.textContent=new Date().toLocaleDateString('ko-KR');
  // í‘œ
  const body=document.getElementById('pBody'); body.innerHTML='';
  ITEMS.forEach((it,i)=>{
    const V=p=>it.type==='toggle'?(S[keyV(p,i)]===true?"ì í•©":S[keyV(p,i)]===false?"ë¶€ì í•©":""):(S[keyV(p,i)]??"")+(it.unit||"");
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${it.g}</td><td>${it.t}</td><td>${V("ì‘ì—…ì „")}</td><td>${V("ì‘ì—…ì¤‘")}</td><td>${V("ì‘ì—…í›„")}</td><td class="noteCell"></td>`;
    tr.querySelector('.noteCell').innerHTML=collectNotes(i);
    body.appendChild(tr);
  });
  // ì‚¬ì§„ (í•­ëª©ë³„ ì „/ì¤‘/í›„ 3ì¹¸ ê³ ì •)
  const host=document.getElementById('pPhotos'); host.innerHTML='';
  let rows=0;
  ITEMS.forEach((it,i)=>{
    const cells=PHASES.map(p=>{
      const data=S[keyD(p,i)], name=S[keyP(p,i)], time=S[keyT(p,i)];
      return (data&&name)?{data,name,time}:null;
    });
    if(!cells[0]&&!cells[1]&&!cells[2]) return;
    rows++;
    const title=document.createElement('div'); title.className='photo-title'; title.textContent=`[${it.g}] ${it.t}`;
    const row=document.createElement('div'); row.className='photo-grid3 row-block';
    row.appendChild(cell(cells[0],'ì‘ì—…ì „'));
    row.appendChild(cell(cells[1],'ì‘ì—…ì¤‘'));
    row.appendChild(cell(cells[2],'ì‘ì—…í›„'));
    host.append(title,row);
  });
  host.style.display = rows? 'block':'none';
}

function cell(obj,label){
  const c=document.createElement('div'); c.className='cell';
  c.innerHTML=`<div class="phase-tag">${label}</div>`;
  const box=document.createElement('div'); box.className='imgbox';
  if(obj){ box.innerHTML=`<img src="${obj.data}" alt="">`; }
  else  { box.innerHTML=`<div class="empty">(ì²¨ë¶€ ì—†ìŒ)</div>`; }
  c.appendChild(box);
  const cap=document.createElement('div'); cap.className='cap';
  cap.innerHTML = `<div class="name">${obj?escapeHTML(obj.name):'&nbsp;'}</div><div class="time">${obj?fmt(obj.time):'&nbsp;'}</div>`;
  c.appendChild(cap);
  return c;
}

/* ========= ì´ë¯¸ì§€ ì••ì¶• ========= */
async function compressImage(file, maxDim=1024, quality=0.8){
  const dataURL = await new Promise((resolve,reject)=>{
    const fr=new FileReader();
    fr.onload=()=>{
      const img=new Image();
      img.onload=()=>{
        const scale=Math.min(1, maxDim/Math.max(img.width,img.height));
        const w=Math.round(img.width*scale), h=Math.round(img.height*scale);
        const cv=document.createElement('canvas'); cv.width=w; cv.height=h;
        const cx=cv.getContext('2d',{alpha:false});
        cx.drawImage(img,0,0,w,h);
        resolve(cv.toDataURL('image/jpeg',quality));
      };
      img.onerror=reject; img.src=fr.result;
    };
    fr.onerror=reject; fr.readAsDataURL(file);
  });
  return {dataURL};
}

/* ========= ì´ë²¤íŠ¸ ========= */
document.getElementById('phaseTabs').onclick=(e)=>{
  const t=e.target;
  if(!t.classList.contains('tab')) return;
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  t.classList.add('active');
  build();
};
document.getElementById('resetBtn').onclick=()=>{ if(confirm('ì´ˆê¸°í™”í• ê¹Œìš”?')){ S={}; save(); build(); } };
document.getElementById('saveBtn').onclick=()=>alert('ì„ì‹œì €ì¥ ì™„ë£Œ');
document.getElementById('printBtn').onclick=()=>{ buildPrint(); window.print(); };
window.addEventListener('beforeprint', buildPrint);
// iOSìš© ì¸ì‡„ ê°ì§€(ì‚¬íŒŒë¦¬)
try{
  const mq=window.matchMedia && window.matchMedia('print');
  if(mq){ (mq.addEventListener?mq.addEventListener('change',h):mq.addListener(h)); }
  function h(e){ if(e.matches) buildPrint(); }
}catch(_){}

/* ì‹œê³„: ì‹œê°„ë§Œ ë…¸ì¶œ */
setInterval(()=>{
  const el=document.getElementById('now'); if(!el) return;
  const d=new Date(); const p=n=>String(n).padStart(2,'0');
  el.textContent = `${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;
},1000);

/* ì‹œì‘ */
build();
</script>
</body></html>
